<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="sys-user-api-create-users-test-suite.xml" />
	<munit:test name="sys-user-api-test-suite-create-users:test-success" doc:id="9850d679-377e-4169-80ea-4729bfa49ba7" description="Test">
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock Next Available User Record" doc:id="6bca644f-a309-4380-9aba-ca7f63b2dbce" processor="db:select">
				<munit-tools:with-attributes>
					<munit-tools:with-attribute whereValue="Next Available User Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[[[]]]" mediaType="application/java" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock User Record" doc:id="963fa6ad-0ba0-4ed2-a48a-45c5baf896e0" processor="db:insert">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="User Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock Account Record" doc:id="059cb451-c67f-4ad8-9968-4ef8fb6c70f3" processor="db:insert">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Account Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock User Details Record" doc:id="f48036db-055f-4298-a6a9-6acdb1c35f0b" processor="db:insert">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="User Details Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Set Event" doc:id="04312cbe-8b35-4007-a56e-cf6a413ed2db" >
				<munit:payload value='#[readUrl("classpath://users/create-users.json")]' encoding="UTF-8" mediaType="application/java" />
			</munit:set-event>
			<flow-ref doc:name="post:\users:application\json:sys-user-api-config" doc:id="d04eb5f4-525a-4d83-a377-0cd40eccef32" name="post:\users:application\json:sys-user-api-config"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:verify-call doc:name="Verify call Increment nextAvailableRecord 2x" doc:id="96552a52-3a9a-4eac-ba40-01959b4a4111" processor="set-variable" times="#[2]">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Increment nextAvailableRecord" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:assert-equals doc:name="Assert Response" doc:id="4546b4a3-cd86-47fd-933a-9fafe7dbdb9f" actual="#[payload.message]" expected='#["Success"]' />
		</munit:validation>
	</munit:test>
	<munit:test name="sys-user-api-create-users-test-suite:test-no-entered-record" doc:id="a77a6ef5-19b8-47e1-a3e2-762ac1494f31" >
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock Next Available User Record" doc:id="77f959d5-9a02-4f6a-b603-3e6cfe212dc7" processor="db:select" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Next Available User Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[[[]]]" mediaType="application/java" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Set Event" doc:id="64ca901d-1112-46a8-8809-b184ca211085" >
				<munit:payload value="#[[]]" encoding="UTF-8" mediaType="application/java" />
			</munit:set-event>
			<flow-ref doc:name="post:\users:application\json:sys-user-api-config" doc:id="5766adfd-73d4-4849-b067-cc54c4896581" name="post:\users:application\json:sys-user-api-config" />
		</munit:execution>
		<munit:validation>
			<munit-tools:verify-call doc:name="Verify call Increment nextAvailableRecord 0x" doc:id="9d552e2c-74c0-4e1a-94e1-153dced368be" processor="set-variable" times="#[0]" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Increment nextAvailableRecord" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
		</munit:validation>
	</munit:test>
	<munit:test name="sys-user-api-create-users-test-suite:test-db-error" doc:id="33a61ca7-e458-4493-80c5-de94fac7d753" expectedErrorType="DB:CONNECTIVITY">
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock Next Available User Record" doc:id="5185ba9b-d8ce-47e7-ae14-661542a055f4" processor="db:select" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Next Available User Record" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="#['DB:CONNECTIVITY']" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Set Event" doc:id="e35072ab-ac17-44b0-93b5-a58f63dd11b6" >
				<munit:payload value='#[readUrl("classpath://users/create-users.json")]' encoding="UTF-8" mediaType="application/java" />
			</munit:set-event>
			<flow-ref doc:name="post:\users:application\json:sys-user-api-config" doc:id="97d808b2-729c-4032-bc53-a2a1be966b4e" name="post:\users:application\json:sys-user-api-config" />
		</munit:execution>
		<munit:validation >
			<munit-tools:verify-call doc:name="Verify call General Error Response" doc:id="b9f605e5-11b7-47dd-aeb9-eeb6c649549d" processor="set-payload">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="General Error Response" attributeName="doc:name" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
		</munit:validation>
	</munit:test>

</mule>

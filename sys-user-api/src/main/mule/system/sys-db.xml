<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<sub-flow name="sys-db-get-user:flow" doc:id="ab0e84f9-6c65-41d4-80dc-84986594170a" >
		<logger level="INFO" doc:name="Start" doc:id="1b1e1199-8c88-471b-b2ac-81136c160c77" message="Start Get User #[vars.username]" category="${log.info}"/>
		<db:select doc:name="User" doc:id="13ae6852-747d-44d0-bb5f-71db9744b73d" config-ref="Database_Config_MySQL">
			<db:sql ><![CDATA[${queries.user.select-user}]]></db:sql>
			<db:input-parameters ><![CDATA[#[output application/json
---
{
	username: vars.username
}]]]></db:input-parameters>
		</db:select>
		<set-payload value="#[output application/json&#10;---&#10;payload]" doc:name="JSON Response" doc:id="9ad13991-4ea3-4f4e-aa6b-46443da66df2" />
		<logger level="INFO" doc:name="End" doc:id="54e75da8-c71f-455f-b5dc-cdd5fd333b03" message="End Get User: #[payload]" category="${log.info}" />
	</sub-flow>
	<sub-flow name="sys-db-get-users:flow" doc:id="a9238f32-9cfb-4300-8026-2681290f36fb" >
		<logger level="INFO" doc:name="Start" doc:id="b7bffb92-9831-4b92-9d7e-ee2ca65b5b90" message="Start Get Users" category="${log.info}"/>
		<db:select doc:name="Users" doc:id="c8a33695-f8d7-443c-826f-6767dc8af6bf" config-ref="Database_Config_MySQL">
			<db:sql><![CDATA[${queries.user.select-users}]]></db:sql>
		</db:select>
		<set-payload value="#[output application/json&#10;---&#10;payload]" doc:name="JSON Response" doc:id="347dcd5d-ab53-4719-85d4-b42dd6e2f0a9" />
		<logger level="INFO" doc:name="End" doc:id="81ee5f13-2896-4ca2-8063-754e1056ae92" message="End Get Users: #[payload]" category="${log.info}" />
	</sub-flow>
	<sub-flow name="sys-db-get-next-available-user-record:flow" doc:id="9edbbfcf-c9ce-4fec-9970-f480c5821a55" >
		<logger level="INFO" doc:name="Start" doc:id="f35906ec-a445-41ae-99d7-3fc03045f233" message="Start Get Next Available User Record" category="${log.info}" />
		<db:select doc:name="Next Available User Record" doc:id="70148ac5-5509-48fa-aade-458dc9d72236" config-ref="Database_Config_MySQL" >
			<db:sql ><![CDATA[${queries.user.select-next-available-user-record}]]></db:sql>
		</db:select>
		<set-payload value="#[output application/java&#10;---&#10;payload[0][0] default 0]" doc:name="Next Available User Record" doc:id="dba62078-d4a7-4736-93e2-d90c7abbed6c" />
		<logger level="INFO" doc:name="End" doc:id="87317073-2c6b-4190-a9b1-7dde8ac166bb" message="End Get Next Available User Record #[payload]" category="${log.info}" />
	</sub-flow>
	<sub-flow name="sys-db-insert-user-record:subflow" doc:id="807a27cc-b335-46c6-a155-58b4acb67638" >
		<logger level="INFO" doc:name="Start" doc:id="dd97968a-56a0-40cf-be2d-c25ada72fec0" message="Start Insert User Record" category="${log.info}" />
		<db:insert doc:name="User Record" doc:id="a2254a1c-8577-442b-b132-3fd75ba92eaa" config-ref="Database_Config_MySQL">
			<db:sql><![CDATA[${queries.user.insert-user-record}]]></db:sql>
			<db:input-parameters><![CDATA[#[output application/java
---
{
	userid: payload.userid,
	dateRegistered: payload.dateRegistered
}]]]></db:input-parameters>
		</db:insert>
		<set-payload value='#[output application/json&#10;---&#10;{&#10;	message: "Success"&#10;}]' doc:name="JSON Response" doc:id="c06270f9-21ca-4e17-90e4-e254e243de5b" />
		<logger level="INFO" doc:name="End" doc:id="6eb36e4f-fc3a-4f75-b1b0-568dc8aa820c" message="End Insert User Record" category="${log.info}" />
	</sub-flow>
	<sub-flow name="sys-db-insert-account-record:subflow" doc:id="c2b73754-b5f3-4339-9304-bd3b8e701d17" >
		<logger level="INFO" doc:name="Start" doc:id="5e561144-5440-4146-9c20-52783b560bec" message="Start Insert Account Record" category="${log.info}" />
		<db:insert doc:name="Account Record" doc:id="c15147ef-cc2c-46b8-8be0-c9daf96f5064" config-ref="Database_Config_MySQL">
			<db:sql><![CDATA[${queries.user.insert-account-record}]]></db:sql>
			<db:input-parameters><![CDATA[#[output application/java
---
{
	username: payload.username,
	active: payload.active,
	userid: payload.userid
}]]]></db:input-parameters>
		</db:insert>
		<set-payload value='#[output application/json&#10;---&#10;{&#10;	message: "Success"&#10;}]' doc:name="JSON Response" doc:id="26ccd66e-7bb4-4719-8fa0-492f89f62a0f" />
		<logger level="INFO" doc:name="End" doc:id="26d5d7cf-b7fb-4d49-87c1-16c6449aa9ef" message="End Insert Account Record" category="${log.info}" />
	</sub-flow>
	<sub-flow name="sys-db-insert-user-details-record:subflow" doc:id="422f87d0-c0a3-4d96-a1f4-b80dd1ae23c1" >
		<logger level="INFO" doc:name="Start" doc:id="473144ca-8938-46d3-9bf2-7231fb686e5b" message="Start Insert User Details Record" category="${log.info}" />
		<db:insert doc:name="User Details Record" doc:id="86e6265c-cea5-4a31-9488-7e6e4385ea86" config-ref="Database_Config_MySQL">
			<db:sql><![CDATA[${queries.user.insert-userdetails-record}]]></db:sql>
			<db:input-parameters><![CDATA[#[output application/java
---
{
	fullname: payload.fullname,
	birthday: payload.birthday,
	gender: payload.gender,
	userid: payload.userid
}]]]></db:input-parameters>
		</db:insert>
		<set-payload value='#[output application/json&#10;---&#10;{&#10;	message: "Success"&#10;}]' doc:name="JSON Response" doc:id="4656b2e2-8208-4b6f-9da3-5b040cd66d9a" />
		<logger level="INFO" doc:name="End" doc:id="9b312d6b-6264-44df-acbb-f58254e78a15" message="End Insert User Details Record" category="${log.info}" />
	</sub-flow>
</mule>
